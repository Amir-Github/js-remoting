<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
	<title>Seam Remoting - Model Example</title>
	<link href="style.css" rel="stylesheet" type="text/css"/>
	<link href="tree.css" rel="stylesheet" type="text/css"/>
</head>

<body>

  <h1>Seam Remoting - Model Example</h1>
  
  <script type="text/javascript" src="seam/resource/remoting/resource/remote.js?compress=true"></script>
  <script type="text/javascript" src="tree.js"></script>
  
  <script type="text/javascript">    
    //<![CDATA[
    
    Seam.debug = true;
    
    var model = null;
    
    function fetch() {
      alert("fetch");
    }
    
    function apply() {
      alert("apply");
    }
  
    function loadPerson() {
      var personId = document.getElementById("personId").value;
      
      model = new Seam.Model();

      var callback = function(model) { var p = model.getValue("person"); alert(p.getFirstName() + " " + p.getLastName()); };
              
      model.addBeanProperty("person", "org.jboss.seam.remoting.examples.model.PersonAction", "person");
      model.fetch(new Seam.Action()
        .setBeanType("org.jboss.seam.remoting.examples.model.PersonAction")
        .setMethod("editPerson")
        .addParam(personId), callback);
    }
    
    function expandModel() {
      var callback = function(model) { alert("Got addresses: " + model.getValue("person").getAddresses().length); };
      
      model.expand(model.getValue("person"), "addresses", callback); 
    }
    
    function modifyPerson() {
      model.getValue("person").setFirstName("bob");
    }
    
    function applyUpdates() {
      var callback = function(model) { alert("updates applied"); };
      
      model.applyUpdates(new Seam.Action()
        .setBeanType("org.jboss.seam.remoting.examples.model.PersonAction")
        .setMethod("savePerson"),
        callback);
    }

    var tm = new xw.controls.TreeModel(new xw.controls.TreeNode("Root"));

    var abc = new xw.controls.TreeNode("ABC");
    tm.getRoot().add(abc);

    abc.add(new xw.controls.TreeNode("123", true));
    abc.add(new xw.controls.TreeNode("456", true));

    var def = new xw.controls.TreeNode("DEF");
    tm.getRoot().add(def);

    def.add(new xw.controls.TreeNode("xxx", true));
    def.add(new xw.controls.TreeNode("yyy", true));
    def.add(new xw.controls.TreeNode("zzz", true));

    // ]]>
  </script>   
  
  <div class="section">
    <div class="sectionHeader">Fetch model action</div>
    <div class="sectionForm">
      <div class="formRow">
        <label for="fetchActionBean">Bean</label>
        <input type="text" id="fetchActionBean" value="org.jboss.seam.remoting.example.model.PersonAction"/>
      </div>
      <div class="formRow">
        <label for="fetchActionQualifiers">Qualifiers</label>
        <input type="text" id="fetchActionQualifiers"/>
      </div>
      <div class="formRow">
        <label for="fetchActionMethod">Method</label>
        <input type="text" id="fetchActionMethod" value="editPerson"/>
      </div>
      <div class="formRow">
        <label for="fetchActionParams">Params</label>
        <input type="text" id="fetchActionParams" value="1"/>
      </div>                 
    </div>
    
    <div class="sectionCommand">
      <button onclick="javascript:fetch()">Fetch</button>
    </div>        
    
    <br class="clear"/>
  </div>
  
  <div class="section">
    <div class="sectionHeader">Apply model action</div>
    <div class="sectionForm">
      <div class="formRow">
        <label for="applyActionBean">Bean</label>
        <input type="text" id="applyActionBean" value="org.jboss.seam.remoting.example.model.PersonAction"/>
      </div>
      <div class="formRow">
        <label for="applyActionQualifiers">Qualifiers</label>
        <input type="text" id="applyActionQualifiers"/>
      </div>
      <div class="formRow">
        <label for="applyActionMethod">Method</label>
        <input type="text" id="applyActionMethod" value="savePerson"/>
      </div>
      <div class="formRow">
        <label for="applyActionParams">Params</label>
        <input type="text" id="applyActionParams"/>
      </div>          
    </div>
    
    <div class="sectionCommand">
      <button onclick="javascript:fetch()">Apply</button>
    </div> 
    
    <br class="clear"/>
  </div>
  
  <div class="section">
    <div class="sectionHeader">Model values</div>
    
    <br class="clear"/>    
  </div>
  
  
  <label for="personId">Person ID</label><input type="text" id="personId" value="1"/>
  
  <button onclick="javascript:loadPerson()">Load person</button> 
  <button onclick="javascript:expandModel()">expand model</button>
  <button onclick="javascript:modifyPerson()">Modify person</button>
  <button onclick="javascript:applyUpdates()">Apply updates</button>

  <div id="tree" style="position:absolute;left:10px;width:300px;height:400px;border:1px solid #999999;overflow:auto"></div>

  <script type="text/javascript">
    //<![CDATA[
    var t = new xw.controls.Tree("tree", tm);
    t.paint();
    // ]]>
  </script> 

</body>
</html>

